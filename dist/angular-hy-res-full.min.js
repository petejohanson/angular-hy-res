/**
 * angular-hy-res - Hypermedia client for AngularJS inspired by $resource
 * @version v0.0.11 - 2015-03-09
 * @link https://github.com/petejohanson/angular-hy-res
 * @author Pete Johanson <peter@peterjohanson.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-hy-res-hal",["angular-hy-res"]).provider("hrHalExtension",function(){this.mediaTypes=["application/hal+json"],this.$get=["hrWebLinkFactory","hrLinkCollection",function(r,e){for(var n={},t=0;t<this.mediaTypes.length;t++)n[this.mediaTypes[t]]=!0;var i=function(){this.applies=function(r,e){return void 0!==n[e("Content-Type")]},this.dataParser=function(r){var e={};return angular.copy(r,e),delete e._links,delete e._embedded,e},this.linkParser=function(n,t,i){if(!angular.isObject(n._links))return null;var o={};return angular.forEach(n._links,function(n,t){angular.isArray(n)||(n=[n]);var s=[];angular.forEach(n,function(e){s.push(r(e,i))}),o[t]=e.fromArray(s)}),o},this.embeddedParser=function(r){var e={};return angular.forEach(r._embedded||{},function(r,n){angular.isArray(r)||(r=[r]),e[n]=r}),e}};return new i}]}).config(["hrResourceProvider",function(r){r.extensions.push("hrHalExtension")}]),angular.module("angular-hy-res-json",["angular-hy-res"]).service("hrJsonExtension",function(){this.applies=function(r,e){return"application/json"===e("Content-Type")},this.dataParser=function(r){return r},this.linkParser=function(){return{}},this.embeddedParser=function(){return[]}}).config(["hrResourceProvider",function(r){r.extensions.push("hrJsonExtension")}]),angular.module("angular-hy-res-siren",["angular-hy-res"]).provider("hrSirenExtension",function(){this.mediaTypes=["application/vnd.siren+json"],this.$get=["hrWebLinkFactory","hrLinkCollection",function(r){for(var e={},n=0;n<this.mediaTypes.length;n++)e[this.mediaTypes[n]]=!0;var t=function(){this.applies=function(r,n){return void 0!==e[n("Content-Type")]},this.dataParser=function(r){var e=r.properties||{};return r.title&&(e.title=r.title),e},this.linkParser=function(e,n,t){var i={};return angular.isObject(e.links)&&angular.forEach(e.links,function(e){for(var n=r(e,t),o=0;o<e.rel.length;o++){var s=e.rel[o];i.hasOwnProperty(s)?i[s].push(n):i[s]=[n]}}),angular.isObject(e.entities)&&angular.forEach(e.entities,function(e){if(e.href)for(var n=r(e,t),o=0;o<e.rel.length;o++){var s=e.rel[o];i.hasOwnProperty(s)?i[s].push(n):i[s]=[n]}}),i},this.embeddedParser=function(r){var e={};return angular.isArray(r.entities)?(angular.forEach(r.entities,function(r){if(!r.href)for(var n=0;n<r.rel.length;n++){var t=r.rel[n];e.hasOwnProperty(t)||(e[t]=[]),e[t].unshift(r)}}),e):e}};return new t}]}).config(["hrResourceProvider",function(r){r.extensions.push("hrSirenExtension")}]);var WebLink=function(r,e,n,t){angular.extend(this,r),this.$$http=e,this.$$Resource=n,this.$$URITemplate=t};WebLink.prototype.follow=function(r){var e=this.href;this.templated&&(e=new this.$$URITemplate(e).expand(r.data)),r=r||{},r.headers=r.headers||{},this.type&&!r.headers.Accept&&(r.headers.Accept=this.type);var n=angular.extend(r||{},{url:e});return this.$$Resource.fromRequest(this.$$http(n))},angular.module("angular-hy-res",[]).factory("URITemplate",["$window",function(r){return r.URITemplate}]).constant("hrWebLink",WebLink).factory("hrLinkCollection",["$q",function(r){function e(){var r=Object.create(Array.prototype);return r=Array.apply(r,arguments)||r,e.injectClassMethods(r),r}return e.injectClassMethods=function(r){for(var n in e.prototype)e.prototype.hasOwnProperty(n)&&(r[n]=e.prototype[n]);return r},e.fromArray=function(r){return e.apply(null,r)},e.prototype={follow:function(e){var n=this.map(function(r){return r.follow(e)});return n.$promise=r.all(n.map(function(r){return r.$promise})),n.$resolved=!1,n.$promise.then(function(){n.$resolved=!0},function(r){n.$resolved=!0,n.$error=r}),n}},e}]).factory("hrWebLinkFactory",["hrWebLink","$http","URITemplate",function(r,e,n){return function(t,i){return new r(t,e,i,n)}}]).provider("hrResource",function(){this.extensions=[],this.$get=["$http","$q","URITemplate","hrLinkCollection","$injector",function(r,e,n,t,i){var o=[];angular.forEach(this.extensions,function(r){o.push(i.get(r))});var s=function(r){var e=function(){return r.apply(this,arguments)};return e.toString=function(){return r.toString()},e}(function(){this.$resolved=!1,this.$error=null,this.$$links={},this.$$embedded={},this.$link=function(r){var e=this.$links(r);if(0===e.length)return null;if(e.length>1)throw"Multiple links present";return e[0]},this.$links=function(r){return this.$$links.hasOwnProperty(r)?this.$$links[r]:[]},this.$followOne=function(r,e){if(this.$resolved){var n=this.$sub(r);if(null!==n)return n;var t=this.$link(r);return null===t?null:t.follow(e)}var i=new s;return i.$promise=this.$promise.then(function(n){return n.$followOne(r,e).$promise}).then(function(r){var e=i.$promise;return angular.copy(r,i),i.$promise=e,i}),i},this.$followAll=function(r,n){if(this.$resolved){var i=this.$subs(r);return i.length>0?i:t.fromArray(this.$links(r)).follow(n)}var o=[];o.$resolved=!1;var s=e.defer();return o.$promise=s.promise,o.$error=null,this.$promise.then(function(e){var n=e.$followAll(r);return Array.prototype.push.apply(o,n),n.$promise}).then(function(){s.resolve(o),o.$resolved=!0},function(r){s.reject(r),o.$resolved=!0,o.$error=r}),o}});return s.prototype.$subs=function(r){return this.$$embedded.hasOwnProperty(r)?this.$$embedded[r]:[]},s.prototype.$sub=function(r){var e=this.$subs(r);if(0===e.length)return null;if(e.length>1)throw"Multiple sub-resources present";return e[0]},s.prototype.$embedded=s.prototype.$sub,s.prototype.$embeddeds=s.prototype.$subs,s.prototype.$has=function(r){return this.$links(r).length>0||this.$subs(r).length>0},s.prototype.$$resolve=function(r,n){angular.forEach(o,function(t){t.applies(r,n)&&(angular.extend(this,t.dataParser(r,n)),angular.extend(this.$$links,t.linkParser(r,n,s)),angular.forEach(t.embeddedParser(r,n,s),function(r,t){if(angular.isArray(r)){var i=r.map(function(r){return s.embedded(r,n)});i.$promise=e.when(i),i.$resolved=!0,this.$$embedded[t]=i}else this.$$embedded[t]=s.embedded(r,n)},this))},this),this.$resolved=!0},s.embedded=function(r,n){var t=new s;t.$$resolve(r,n);var i=e.defer();return t.$promise=i.promise,i.resolve(t),t},s.fromRequest=function(r){var e=new s;return e.$promise=r.then(function(r){return e.$$resolve(r.data,r.headers),e},function(){}),e},s}]}).factory("hrRoot",["hrWebLink","hrResource","$http",function(r,e,n){return function(t,i){return{follow:function(){return new r({href:t},n,e).follow(i)}}}}]);var hrLinkHeader=function(r){function e(t){if(n[t])return n[t].exports;var i=n[t]={exports:{},id:t,loaded:!1};return r[t].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=r,e.c=n,e.p="",e(0)}([function(r,e,n){var t=n(1);angular.module("angular-hy-res-link-header",["angular-hy-res"]).service("hrLinkHeaderExtension",function(r){this.applies=function(r,e){return null!==e("Link")},this.dataParser=function(){return{}},this.linkParser=function(e,n,i){for(var o=t.parse(n("Link")),s={},a=0;a<o.length;a++){var u=o[a],l=r(u,i);angular.isUndefined(s[u.rel])?s[u.rel]=[l]:s[u.rel].push(l),delete u.rel}return s},this.embeddedParser=function(){return[]}}).config(["hrResourceProvider",function(r){r.extensions.push("hrLinkHeaderExtension")}])},function(r,e){var n,t;!function(){function i(r,e){for(;e<r.length&&d.indexOf(r.charAt(e))>=0;)e++;return e}function o(r,e){for(var n=e;e<r.length&&-1==$.indexOf(r.charAt(e));)e++;return r.substring(n,e)}function s(r,e){var n,t=e;for(e++;e<r.length&&(n=r.charAt(e),'"'!==n);)"\\"===n&&e++,e++;return r.substring(t,e+1)}function a(r){r=r.substr(1,r.length-2);for(var e,n=0,t="";-1!=(e=r.indexOf("\\",n));)t+=r.substring(n,e),n=e+2;return t+=r.substring(n)}function u(r,e,n){var t=o(r,e);if(e=i(r,e+t.length),"="!==r.charAt(e))throw new Error("Unexpected token: "+e);e++;var u,l='"'===r.charAt(e);if(l)u=s(r,e),e+=u.length,u=a(u);else if(u=o(r,e),e+=u.length,"type"==t){if("/"!==r.charAt(e))throw new Error("Unexpected token: "+e);e++;var h=o(r,e);e+=h.length,u+="/"+h}return n[t]=u,e}function l(r,e,n){if("<"!==r.charAt(e))throw new Error("Unexpected token: "+e);var t=r.indexOf(">",e);if(-1===t)throw new Error("Unexpected token: "+e);for(n.href=r.substring(e+1,t),e=i(r,t+1);e<r.length&&";"===r.charAt(e);)e=i(r,e+1),e=u(r,e,n),e=i(r,e);return e}var h="	",f=" ",c="\r",p="\n",d=[f,h,c,p],$=["(",")","<",">","@",",",";",":","\\",'"',"/","[","]","?","=","{","}",f,h],v={};v.parse=function(r){for(var e,n=0,t=[];n<r.length&&(0===n||","===r.charAt(n)&&n++);)e={},n=i(r,n),n=l(r,n,e),t.push(e),n=i(r,n);if(n<r.length)throw new Error("Unexpected token: "+n);return t},v.stringify=function(r){return r.map(function(r){var e=(r.href,Object.keys(r).filter(function(r){return"href"!==r}).map(function(e){return e+"="+JSON.stringify(r[e])}));return["<"+r.href+">"].concat(e).join("; ")}).join(", ")},n=[],t=function(){return v}.apply(e,n),!(void 0!==t&&(r.exports=t))}()}]);